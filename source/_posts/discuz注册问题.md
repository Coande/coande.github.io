title: discuz注册问题
tags:
  - discuz
  - smtp
  - 邮件设置
id: 240
categories:
  - 技巧
date: 2015-04-23 18:45:10
---

#### **问题一：**

背景：

论坛开启了手机版，”注册与访问控制”里的“注册”使用了“通过邮件发送注册链接”。在电脑版注册是没有问题的（第一次填写信息时只需要填写E-mail和验证码即可，然后需要从邮箱的链接过来填写用户其它信息才能进行注册）。但在手机上注册就出问题了，手机版并不同步你电脑版的注册项目，手机版上提示输入的项目里仍然有“用户名”、“密码”、“确认密码”等项目。手机版上注册时虽然可以填入“用户名”、“密码”、“确认密码”，并能够提交成功，但是，这些都是无用的信息，只需要提交E-mail和验证码信息即可（即“用户名”、“密码”、“确认密码”不填写照样能提交成功），然后也是需要使用邮箱的注册链接过来注册的再填写用户名”、“密码”、“确认密码”等信息。这样子十分别扭。我刚刚开始还以为是因为缓存导致这个问题，但是，所有缓存更新了还是这个样子。<!--more-->

![电脑版注册页面](http://7xi6qe.com1.z0.glb.clouddn.com/2015/04/23/截图20150423171538.png)

![手机版注册页面](http://7xi6qe.com1.z0.glb.clouddn.com/2015/04/23/Screenshot_2015-04-23-17-16-38.png)

原因分析：

其实这种情况是正常的。是因为开启了“手机版访问设置”里的手机版注册而导致的（其实这个设置的地方也有提示的，只不过不知道会导致这个问题罢了~）。

**解决方法：**
- 直接关闭手机版注册就不可以在手机版进行注册了。这个方法有个不好的地方就是手机版上还是有“注册”字眼，但是点击却是没反应的，用户体验不好。
- 你可以根据实际需要更改手机版注册页面达到与电脑版一致（删除“用户名”、“密码”、“确认密码”等输入项目）。
- 干脆不使用“通过邮件发送注册链接”而使用“E-mail验证”，这样就不会导致这个别扭的问题了。

#### **问题二：**

背景：

用户注册的时候，会出现概率性问题，有时候能够将邮件发送成功，但有时候却不能，有时候会提示注册成功并能够跳转并登录，但有时候却一直没提示注册成功并在多次重复填写相同用户名后，它却提示用户名已被注册了。到后台查看，邮件设置并没有错误，并且进行邮件检测能够发送成功。

原因分析：这个原因我也不清楚，但是我知道，邮件设置里邮件发送方式不应该使用“通过 PHP 函数的 sendmail 发送(推荐此方式)”，我就是被这“推荐”字眼迷惑了的，这种方式发送邮件不稳定。

**解决方法：**
使用“通过 SOCKET 连接 SMTP 服务器发送(支持 ESMTP 验证)”的方式发送邮件。
设置方法（以QQ邮箱设置为例）：
首先，我们得先到邮箱账户设置里开启smtp服务，开启smtp服务需要设置独立密码。设置好QQ邮箱后回到discuz邮件设置，添加smtp服务器，smtp服务器填写qq邮箱的smtp服务器smtp.qq.com，端口25（默认就是25，QQ邮箱官网给出的端口却是465或587，我分别设置了465和587，多次检测都是发送失败，设置回25就OK了，不知道为什么这么忽悠人），验证打勾，发信人邮件地址和SMTP 身份验证用户名都填写自己的QQ邮箱地址，SMTP 身份验证密码填写你邮箱的独立密码。邮件头的分隔符根据自己主机操作系统而定，可以在discuz后台首页中查看自己的主机操作系统，提交后“检测”一下，提示发送成功即可。